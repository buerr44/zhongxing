<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据中心</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>
    <link id="bootstrap-rtl-link" href="" rel="stylesheet"/>
    <link href="/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="/css/weather-icons.min.css" rel="stylesheet"/>

    <link
            href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300"
            rel="stylesheet" type="text/css">

    <link href="/css/demo.min.css" rel="stylesheet"/>
    <link href="/css/typicons.min.css" rel="stylesheet"/>
    <link href="/css/animate.min.css" rel="stylesheet"/>
    <link href="/css/bootstrap-editable.css" rel="stylesheet"/>
    <link href="/css/bootstrap-table.css" rel="stylesheet"/>
    <link href="/css/toastr.css" rel="stylesheet"/>
    <link href="/css/fileinput.min.css" rel="stylesheet"/>
    <link href="/css/bootstrap-switch.min.css" rel="stylesheet"/>

    <script src="/js/jquery-2.0.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/bootstrap-editable.min.js"></script>
    <script src="/js/bootstrap-table.js?t=4"></script>
    <script src="/js/bootstrap-table-zh-CN.js"></script>
    <script src="/js/bootstrap-table-editable.js"></script>
    <script src="/js/toastr.js"></script>
    <script src="/js/bootbox.min.js"></script>
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/js/fileinput.min.js"></script>
    <script src="/js/fileinput_local_zh.js"></script>
    <script src="/js/bootstrap-switch.min.js"></script>
    <style>
        .panel-heading{font-size: 20px;font-weight: bolder}
        img {
            width:100%;
        }
        .btn-info,.btn-danger{
            width:80%;margin-left:10%
        }

    </style>
    <script>
        toastr.options = {
            "closeButton": true, //是否显示关闭按钮
            "positionClass": "toast-top-right", //弹出窗的位置
            "showDuration": "300", //显示的动画时间
            "hideDuration": "300", //消失的动画时间
            "timeOut": "3000", //展现时间
            "showEasing": "swing", //显示时的动画缓冲方式
            "hideEasing": "linear", //消失时的动画缓冲方式
            "showMethod": "fadeIn", //显示时的动画方式
            "hideMethod": "fadeOut" //消失时的动画方式
        };
        var FileInputInit = function (){
            var oFileInputInit = new Object();
            oFileInputInit.Init = function(){
                $("#txt_pic").fileinput({
                    language: 'zh', //设置语言
                    allowedFileExtensions: ['jpg', 'png', 'bmp', 'jpeg'],//接收的文件后缀
                    showPreview: true,              //展前预览
                    showUpload: false,
                    autoReplace: true,
                    maxFileSize: 1024,//上传文件最大的尺寸
                    maxFilesCount: 1,//
                    dropZoneEnabled: true,//是否显示拖拽区域
                    browseClass: "btn btn-primary", //按钮样式
                    previewSettings: {image: {width: "200px", height: "100px"},},
                    msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
                })
            };
            return oFileInputInit;
        }

    </script>
</head>
<body>
<div style="width: 95%;margin: 20px auto;">
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    弹窗开启状态
                </div>
                <div class="panel-body" style="height: 80px">
                    <div style="margin: auto;width: 20%">
                        <input id="status" type="checkbox" data-size="large">
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-8">
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-info" onclick="saveStatus()">保存</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="panel panel-default">
                <div class="panel-heading">
                    超链接地址
                </div>
                <div class="panel-body" style="height: 80px">
                    <span id="url" style="font-size: 20px;margin-top: 5px">这是超链接地址</span>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-10">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-info" onclick="openUrlWin()">配置</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    弹窗图片
                </div>
                <div class="panel-body">
                    <img src="" id="pic"/>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-8">
                        </div>
                        <div class="col-md-2">
                            <button id="upload" class="btn btn-info" onclick="openUploadWin()">上传</button>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-danger" onclick="confirmDelete()">删除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form id="txt_form" enctype="multipart/form-data">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="myModalLabel">上传弹窗图片</h4>
                </div>
                <div class="modal-body" style="float: left">
                    <div class="form-group" id="pic_container" style="width:570px;float:left">
                        <label for="txt_pic">弹窗图片上传</label>
                        <input type="file" name="file" class="form-control" id="txt_pic" placeholder="请选择图片">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span
                            class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
                    </button>
                    <button type="button" class="btn btn-primary" id="btn_submit" onclick="uploadPic()"><span
                            class="glyphicon glyphicon-refresh" aria-hidden="true"></span>上传
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="myModalLabel2">上传超链接地址</h4>
                </div>
                <div class="modal-body" style="float: left">
                    <div class="form-group" style="width:570px;float:left">
                        <label for="txt_url">超链接地址</label>
                        <input type="text" class="form-control" id="txt_url" placeholder="请输入超链接地址">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span
                            class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
                    </button>
                    <button type="button" class="btn btn-primary" id="btn_submit2" onclick="uploadUrl()"><span
                            class="glyphicon glyphicon-refresh" aria-hidden="true"></span>上传
                    </button>
                </div>
        </div>
    </div>
</div>
<script>
    var oFileInput = new FileInputInit();
    oFileInput.Init();

    var filePath = "https://www.feggle.cn:8443/fileweb";
    // var filePath = "http://localhost:9002/";

    var status = 0;

    $.ajax({
        url:"popup/getPopupInfo",
        method:"post",
        dataType:"json",
        success:function(d){
            if(d != null) {
                status = d.status;
                if(d.url == null || d.url.trim() == ""){
                    $("#url").text("超链接暂时为空");
                }else{
                    $("#url").text(d.url);
                }
                if(d.pic != null && d.pic.trim() != ""){
                    $("#pic").attr("src",filePath+d.pic);
                    $("#upload").text("替换");
                }
                $("#status").bootstrapSwitch({
                    onText:"ON",
                    offText:"OFF",
                    onColor:"success",
                    offColor:"danger",
                    onSwitchChange:function(event,state){
                        if(state == true){
                            status = 0;
                        }else{
                            status = -1;
                        }
                    }
                }).bootstrapSwitch("size","large").bootstrapSwitch('state',status == 0?true:false);
            }
        },
        error:function(){
            toastr.warning("网络繁忙,请稍后再试")
        }
    })

    function saveStatus(){
        $.ajax({
            url:"popup/changeStatus",
            data:{
                status:status
            },
            method:"post",
            dataType:"json",
            success:function(d){
                if (d == 1) {
                    status = status==0?-1:0;
                    $("#status").bootstrapSwitch('state',status == 0?true:false);
                    toastr.warning("系统开小差啦,请联系管理员");
                }else{
                    toastr.success("弹窗状态修改成功");
                }
            },
            error:function(){
                toastr.warning("网络繁忙,请稍后再试")
            }
        })
    }

    function openUploadWin(){
        $("#txt_pic").val("");
        $(".fileinput-remove-button").click();
        $('#myModal').modal();
    }

    function openUrlWin(){
        $("#txt_url").val($("#url").text())
        $('#myModal2').modal();
    }


    function uploadPic(){
        if ($("#txt_pic").val() == null || $("#txt_pic").val().trim() == "") {
            toastr.warning("请上传弹窗图片");
        } else {
            $("#btn_submit").prop("disabled",true);
            $.ajax({
                url: "popup/uploadPic",
                data: new FormData($("#txt_form")[0]),
                type: "POST",
                // 告诉jQuery不要去处理发送的数据，用于对data参数进行序列化处理 这里必须false
                processData: false,
                // 告诉jQuery不要去设置Content-Type请求头
                contentType: false,
                success: function (d) {
                    $("#btn_submit").prop("disabled",false);
                    if (d == 1) {
                        toastr.warning("系统开小差啦,请联系管理员");
                    } else {
                        $("#pic").attr("src",filePath+d);
                        $("#upload").text("替换")
                        $('#myModal').modal('hide');
                        toastr.success("弹窗图片上传成功");
                    }
                },
                error: function (json) {
                    toastr.warning("网络繁忙,请稍后再试");
                }
            });
        }
    }
    function uploadUrl(){
        if ($("#txt_url").val() == null || $("#txt_url").val().trim() == "") {
            toastr.warning("请填写超链接地址");
        } else {
            $("#btn_submit2").prop("disabled",true);
            $.ajax({
                url: "popup/uploadUrl",
                data: {
                    url:$("#txt_url").val()
                },
                method:"post",
                dataType:"json",
                success: function (d) {
                    $("#btn_submit2").prop("disabled",false);
                    if (d == 1) {
                        toastr.warning("系统开小差啦,请联系管理员");
                    } else {
                        $("#url").text($("#txt_url").val());
                        $('#myModal2').modal('hide');
                        toastr.success("超链接上传成功");
                    }
                },
                error: function (json) {
                    toastr.warning("网络繁忙,请稍后再试");
                }
            });
        }
    }
    function confirmDelete(){
        if($("#pic").attr("src") == null || $("#pic").attr("src").trim() == "" ){
            toastr.warning("弹窗图为空,无需删除");
        }else {
            bootbox.confirm({
                size: "small",
                message: "确认删除弹窗图吗?",
                buttons: {
                    confirm: {
                        label: '确定',
                        className: 'btn-success'
                    },
                    cancel: {
                        label: '取消',
                        className: 'btn-danger'
                    }
                },
                callback: function (result) { /* result is a boolean; true = OK, false = Cancel*/
                    if (result) {
                        deletePic();
                    } else {
                    }
                }
            });
        }
    }

    function deletePic(){
        $.ajax({
            url:"popup/deletePic",
            method:"post",
            dataType:"json",
            success:function(d){
                if (d == 0) {
                    $("#pic").attr("src","");
                    $("#upload").text("上传")
                    toastr.success("弹窗图删除成功");
                } else {
                    toastr.warning("系统开小差啦,请联系管理员");
                }
            },
            error:function(){
                toastr.warning("网络繁忙,请稍后再试")
            }
        })
    }
</script>
</body>
</html>
